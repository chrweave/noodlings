<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> </meta>
  <title>Ultra Violent Battle of Phrases</title>
  <style>
    .circle-container {
      position: relative;
      width: 18em;
      height: 18em;
      padding: 2em;
      border: dashed 1px;
      border-radius: 50%;
      margin: 1.75em auto 0;
      background-color:#cccccc;
    }
    .circle-container div {
      position:absolute;
      top:50%;
      left:50%;
      border-radius: 50%;
      dorder-color: #000000;
      cursor:pointer;
      display:block;
      width:3em;
      height:3em;
      text-align: center;
      vertical-align: middle;
      margin: -1.5em;
    }
    .hex0 { transform: translate(9em); } /* 9em = half the width of the wrapper */
    .hex1 { transform: rotate(25grad)  translate(9em) rotate(-25grad); }
    .hex2 { transform: rotate(50grad)  translate(9em) rotate(-50grad); }
    .hex3 { transform: rotate(75grad)  translate(9em) rotate(-75grad); }
    .hex4 { transform: rotate(100grad) translate(9em) rotate(-100grad); }
    .hex5 { transform: rotate(125grad) translate(9em) rotate(-125grad); }
    .hex6 { transform: rotate(150grad) translate(9em) rotate(-150grad); }
    .hex7 { transform: rotate(175grad) translate(9em) rotate(-175grad); }
    .hex8 { transform: rotate(200grad) translate(9em) rotate(-200grad); }
    .hex9 { transform: rotate(225grad) translate(9em) rotate(-225grad); }
    .hexa { transform: rotate(250grad) translate(9em) rotate(-250grad); }
    .hexb { transform: rotate(275grad) translate(9em) rotate(-275grad); }
    .hexc { transform: rotate(300grad) translate(9em) rotate(-300grad); }
    .hexd { transform: rotate(325grad) translate(9em) rotate(-325grad); }
    .hexe { transform: rotate(350grad) translate(9em) rotate(-350grad); }
    .hexf { transform: rotate(375grad) translate(9em) rotate(-375grad); }
    .defenseCheckBox {display:none;}
    .stradio {transform:scale(2);}
  </style>
</head>
<body onload="return setShield()">
  <div id="chooseYourNamePlayerOne" >
    <form id="player1form" onSubmit="return pOneName()" style="display:inline">
      <h2>
        Player 1 Character Name
      </h2>
      <input type="text" id="pone" style="width:100%"/>
      <input type="submit" />
    </form>
    <form id="player2form" onSubmit="return pTwoName()" style="display:none">
      <h2>
        Player 2 Character Name
      </h2>
      <input type="text" id="ptwo" style="width:100%"/>
      <input type="submit" />
    </form>
  </div>
  <div id="battle">
    <div>
      <h2>
        <table style="width:100%">
          <tr>
            <td style="float:left" id="p1n">
            </td>
            <td style="float:right" id="p2n">
            </td>
          </tr>
          <tr style="color:Red">
            <td class="playerhealth" style="float:left" id="p1h">
            </td>
            <td class="playerhealth" style="float:right" id="p2h">
            </td>
          </tr>
          <tr >
            <td class="playeraction" style="float:left" id="p1action">
            </td>
            <td class="playeraction" style="float:right" id="p2action">
            </td>
          </tr>
        </table>
      </h2>
    </div><br/>
    <div style="display:block">
      <h1 id="actionBanner">
      </h1>
      <form id="actionForm" onSubmit="return handleAction()" style="display:none">
        <input type="text" id="myAction" style="width:100%"/>
        <h2 id="myAttack">Attack Strength:</h2>
        <table id="subMyAttack" style="border-spacing:1em">
          <tr>
            <td><input type="radio" name="stradio" class="stradio" id="myAttack0" value="1" checked="checked"/> <label for="myAttack0">1 </label></td>
            <td><input type="radio" name="stradio" class="stradio" id="myAttack1" value="2"/> <label for="myAttack1">2 </label></td>
            <td><input type="radio" name="stradio" class="stradio" id="myAttack2" value="3"/> <label for="myAttack2">3 </label></td>
            <td><input type="radio" name="stradio" class="stradio" id="myAttack3" value="4"/> <label for="myAttack3">4 </label></td>
          </tr>
          <tr>
            <td><input type="radio" name="stradio" class="stradio" id="myAttack4" value="5"/> <label for="myAttack4">5 </label></td>
            <td><input type="radio" name="stradio" class="stradio" id="myAttack5" value="6"/> <label for="myAttack5">6 </label></td>
            <td><input type="radio" name="stradio" class="stradio" id="myAttack6" value="7"/> <label for="myAttack6">7 </label></td>
            <td><input type="radio" name="stradio" class="stradio" id="myAttack7" value="8"/> <label for="myAttack7">8 </label></td>
          </tr>
          <tr>
            <td><input type="radio" name="stradio" class="stradio" id="myAttack8" value="9"/> <label for="myAttack8">9 </label></td>
            <td><input type="radio" name="stradio" class="stradio" id="myAttack9" value="10"/><label for="myAttack9">10</label></td>
            <td><input type="radio" name="stradio" class="stradio" id="myAttacka" value="11"/><label for="myAttacka">11</label></td>
            <td><input type="radio" name="stradio" class="stradio" id="myAttackb" value="12"/><label for="myAttackb">12</label></td>
          </tr>
          <tr>
            <td><input type="radio" name="stradio" class="stradio" id="myAttackc" value="13"/><label for="myAttackc">13</label></td>
            <td><input type="radio" name="stradio" class="stradio" id="myAttackd" value="14"/><label for="myAttackd">14</label></td>
            <td><input type="radio" name="stradio" class="stradio" id="myAttacke" value="15"/><label for="myAttacke">15</label></td>
            <td><input type="radio" name="stradio" class="stradio" id="myAttackf" value="16"/><label for="myAttackf">16</label></td>
          </tr>
        </table>
        <span id="defenseCheckBoxes" style="display:none">
          <div class="circle-container">
            <div class="tdbh hex0" onClick="setButton(this)"><input type="checkbox" class="defenseCheckBox"/></div>
            <div class="tdbh hex1" onClick="setButton(this)"><input type="checkbox" class="defenseCheckBox"/></div>
            <div class="tdbh hex2" onClick="setButton(this)"><input type="checkbox" class="defenseCheckBox"/></div>
            <div class="tdbh hex3" onClick="setButton(this)"><input type="checkbox" class="defenseCheckBox"/></div>
            <div class="tdbh hex4" onClick="setButton(this)"><input type="checkbox" class="defenseCheckBox"/></div>
            <div class="tdbh hex5" onClick="setButton(this)"><input type="checkbox" class="defenseCheckBox"/></div>
            <div class="tdbh hex6" onClick="setButton(this)"><input type="checkbox" class="defenseCheckBox"/></div>
            <div class="tdbh hex7" onClick="setButton(this)"><input type="checkbox" class="defenseCheckBox"/></div>
            <div class="tdbh hex8" onClick="setButton(this)"><input type="checkbox" class="defenseCheckBox"/></div>
            <div class="tdbh hex9" onClick="setButton(this)"><input type="checkbox" class="defenseCheckBox"/></div>
            <div class="tdbh hexa" onClick="setButton(this)"><input type="checkbox" class="defenseCheckBox"/></div>
            <div class="tdbh hexb" onClick="setButton(this)"><input type="checkbox" class="defenseCheckBox"/></div>
            <div class="tdbh hexc" onClick="setButton(this)"><input type="checkbox" class="defenseCheckBox"/></div>
            <div class="tdbh hexd" onClick="setButton(this)"><input type="checkbox" class="defenseCheckBox"/></div>
            <div class="tdbh hexe" onClick="setButton(this)"><input type="checkbox" class="defenseCheckBox"/></div>
            <div class="tdbh hexf" onClick="setButton(this)"><input type="checkbox" class="defenseCheckBox"/></div>
          </div>
        </span>
        <input type="submit" />
      </form>
      <form id="victoryForm" onSubmit="return handleVictory()" style="display:none">
        <input type="submit" />
      </form>
      <form id="totalVictoryForm" onSubmit="return handleTotalVictory()" style="display:none">
        <input type="radio" id="yes" name="continue" value="yes">
        <label for="yes">Yes</label><br>
        <input type="radio" id="no" name="continue" value="no">
        <label for="no">No</label><br>
        <input type="submit" />
      </form>
    </div>
  </div>
  <script>
    var checkmap=new Map();
    var colorScheme=["BlueViolet","CornflowerBlue","DodgerBlue","Chartreuse","Gold","DarkOrange","Red"]
    var p1form=document.getElementById("player1form");
    var p2form=document.getElementById("player2form");
    var myNames=["",""];
    var health=[0,0];
    var healthStrings=document.getElementsByClassName("playerhealth");
    var actionStrings=document.getElementsByClassName("playeraction");
    var theBoxes=document.getElementsByClassName("defenseCheckBox");
    var attackVector=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var defense;
    var attack;
    var turnToggle = 1;
    var attackToggle = 0;
    var attackStrength = 0;
    var defenseStrength = 0;
    var shotCircles=document.getElementsByClassName("tdbh");
    function setShield(){
      var checks=document.getElementsByClassName("defenseCheckBox");
      var i = 0;
      for(i=0;i<checks.length;i++){
        checkmap.set(shotCircles[i],checks[i]);
      }
    }
    function setButton(e){
      var q=checkmap.get(e);
      if(q.checked == false){
        defenseStrength++;
        if(defenseStrength > attackStrength){
          defenseStrength--;
        } else {
          e.style.width="2.4em";
          e.style.border=".4em solid #000000";
          e.style.height="2.4em";
          q.checked=true;
        }
      } else {
        resetBlocker(e);
        defenseStrength--;
        q.checked=false;
      }
      document.getElementById("actionBanner").innerHTML=myNames[1-turnToggle]+" Defense &mdash; Available Blockers: "+(attackStrength-defenseStrength);
    }
    function resetBlocker(e){
      e.style.width="3em";
      e.style.border="none";
      e.style.height="3em";
    }
    function handleTotalVictory(){
      if(document.getElementById("yes").checked){
        document.getElementById("totalVictoryForm").style.display="none";
        resetGame();
        return false;
      } else {
        return true;
      }
    }
    function getNumberOfShotsBlocked(){
      var e;
      var k = 0;
      var q = 0;
      for(e=0;e<theBoxes.length;e++){
        q=theBoxes[e].checked?1:0;
        k+=q*attackVector[e];
        theBoxes[e].checked=false;
        resetBlocker(shotCircles[e]);
      }
      return k;
    }
    function pOneName(){
      myNames[0]=document.getElementById("pone").value;
      document.getElementById("p1n").innerHTML=myNames[0];
      p1form.style.display = "none";
      p2form.style.display = "inline";
      return false;
    }
    function hashAttack (word){
      var hash = 11720509;
      var prime = 1048837;
      var nums=numberize(word);
      var i = 0;
      var j = 0;
      var k = 0;
      var temp;
      for(i=0;i<16;i++){
        attackVector[i]=i<attackStrength?1:0;
      }
      for(i=0;i<nums.length;i++){
        hash=hash^nums[i];
        hash*=prime;
        hash&=0xffffff;
      }
      for(i=15;i>0;i--){
        hash=hash^nums[i%nums.length];
        hash*=prime;
        hash&=0xffffff;
        k=hash*i;
        k/=16777216;
        k=Math.floor(k);
        temp=attackVector[i];
        attackVector[i]=attackVector[k];
        attackVector[k]=temp;
      }
      getHint();
    }
    function numberize (e){
      return e.split("").map(x => x.charCodeAt([0]));
    }
    function validateStrength(){
      var stradios=document.getElementsByClassName("stradio");
      var i;
      var test=0;
      for(i=0;i<stradios.length;i++){
        if(stradios[i].checked){
          attackStrength=parseInt(stradios[i].value);
        }
      }
      document.getElementById("actionBanner").innerHTML=myNames[1-turnToggle]+" Defense &mdash; Available Blockers: "+attackStrength;
      hideAttackStrength();
      return true;
    }
    function hideAttackStrength(){
      document.getElementById("myAttack").style.display="none";
      document.getElementById("subMyAttack").style.display="none";
      document.getElementById("defenseCheckBoxes").style.display="block";
    }
    function getHint(){ // convolve attack mod 7
      var convKernel=[6,4,1,0,0,0,0,0,0,0,0,0,0,0,1,4];
      var myhints=document.getElementsByClassName("tdbh");
      var hint;
      var i;
      var j;
      for(i=0;i<16;i++){
        hint=0;
        for(j=0;j<16;j++){
          hint+=attackVector[j]*convKernel[(j+16-i)%16];
        }
        myhints[i].style.backgroundColor=colorScheme[hint%7];
      }
    }
    function pTwoName(){
      myNames[1]=document.getElementById("ptwo").value;
      document.getElementById("p2n").innerHTML=myNames[1];
      p2form.style.display = "none";
      resetGame();
      return false;
    }
    function processAttack(){
    alert(turnToggle);
      actionStrings[turnToggle].innerHTML=attack=document.getElementById("myAction").value;
      actionStrings[turnToggle].style.color="Blue";
      document.getElementById("myAction").value = "";
      document.getElementById("myAction").style.display="none";
    }
    function processStrength(){
      if(!validateStrength()){
            return false;
      }
      hashAttack(myNames[turnToggle]+attack);
      attackToggle++;
    }
    function handleAction(){
      switch(attackToggle){
        case 0:
          processAttack();
          processStrength();
          break;
        default:
          calculateBattle();
      }
      return false;
    }
    function calculateVictor(attackNum,defenseNum){
      if (attackNum > defenseNum){
        if(turnToggle == 0){
          document.getElementById("actionBanner").innerHTML=myNames[0]+" wins the battle!"
        } else{
          document.getElementById("actionBanner").innerHTML=myNames[1]+" wins the battle!"
        }
      } else {
        if(attackNum == defenseNum){
          document.getElementById("actionBanner").innerHTML="The battle was tied."
        } else {
          if(turnToggle == 0){
            document.getElementById("actionBanner").innerHTML=myNames[1]+" wins the battle!"
          } else{
            document.getElementById("actionBanner").innerHTML=myNames[0]+" wins the battle!"
          }
        }
      }
      return false;
    }
    function nonNeg(n){
      if (n<0){
        n=0;
      }
      return n;
    }
    function calculateBattle(){
      var i;
      document.getElementById("actionForm").style.display="none";
      document.getElementById("defenseCheckBoxes").style.display="none";
      document.getElementById("victoryForm").style.display="inline";
      dnum = getNumberOfShotsBlocked();
      anum = attackStrength-dnum;
      health[turnToggle]=nonNeg(health[turnToggle]-anum);
      health[1-turnToggle]=nonNeg(health[1-turnToggle]-dnum);
      displayHealth();
      calculateVictor(-anum,-dnum);
      return false;
    }
    function handleVictory(){
      document.getElementById("victoryForm").style.display="none";
      if(health[1] == 0){
        if(health[0] == 0){
          document.getElementById("actionBanner").innerHTML="Both "+myNames[0]+" and "+myNames[1]+" have died. <br/> Play again?"
          document.getElementById("totalVictoryForm").style.display="inline";
          return false;
        }
        document.getElementById("actionBanner").innerHTML=myNames[0]+" is the winner and "+myNames[1]+" has died. <br/> Play again?"
        document.getElementById("totalVictoryForm").style.display="inline";
        return false;
      } else {
        if(health[0] == 0){
          document.getElementById("actionBanner").innerHTML = myNames[1]+" is the winner and "+myNames[0]+" has died. <br/> Play again?"
          document.getElementById("totalVictoryForm").style.display="inline";
          return false;
        } else {
          clearAttacks();
          displayHealth();
          return false;
        }
      }
    }
    function clearAttacks(){
      document.getElementById("actionForm").style.display="inline";
      turnToggle=1-turnToggle;
      attackToggle=0;
      defenseStrength=0;
      document.getElementById("actionBanner").innerHTML=myNames[turnToggle]+" Attack:";
      health[0]++;
      health[1]++;
      document.getElementById("p1action").innerHTML
          = document.getElementById("p2action").innerHTML
          = attack
          = defense
          = "";
      document.getElementById("myAction").style.display="block";
      document.getElementById("myAttack").style.display="block";
      document.getElementById("subMyAttack").style.display="block";
    }
    function displayHealth(){
      document.getElementById("p1h").innerHTML= health[0];
      document.getElementById("p2h").innerHTML= health[1];
      return false;
    }
    function resetGame(){
      health[0] = health[1] = 19;
      clearAttacks();
      document.getElementById("actionForm").style.display="inline";
      document.getElementById("actionBanner").innerHTML=myNames[0]+" Attack:"
      displayHealth();
      return false;
    }
  </script>
</body>
</html>
