<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Calculation</title>
</head>
<body>
    <form id="calculationForm">
        <label for="checkbox">Check this for an invisible copy</label>
        <input type="checkbox" id="copyCheckbox" unchecked><br/>
        <label for="textInput">Text Input:</label>
        <input type="text" id="textInput" required><br/>
        <label for="numberInput">Number Input:</label>
        <input type="number" id="numberInput" required><br/>
        <input type="submit" value="Calculate">
    </form>
    <p id="resultParagraph"></p>

    <script>
        function p() {
            x = (x + 1) % l;
            let t = b[x];
            y = (y + t) % l;
            b[x] = b[y];
            b[y] = t;
            return b[(t + b[x]) % l];
        }        
        function m(u) {
            return [u.length, ...u];
        }
        var x = 0;
        var y = 0;
        let l = 1820;
        var b = [];
        var result='';
        let n = 'abcdefghijklmnopqrstuvwxyz';
        let k = [m('!@#$._+'), m(n), m(n.toUpperCase()), m('0123456789')];        
        document.getElementById('calculationForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const textInput = document.getElementById('textInput').value;
            const numberInput = document.getElementById('numberInput').value;
            const checkbox = document.getElementById('copyCheckbox');
            x = 0;
            y = 0;
            b = Array.from({ length: l }, (_, i) => i);
            for (let i of [...textInput].map(v => v.charCodeAt(0))) {
                y += i;
                p();
            }        
            for (let i = 0; i < 8 * l; i++) {
                p();
            }        
            let g = [p() % 4, p() % 4];
            while (g.length < numberInput) {
                let a = p() % 4;
                if (a !== g[g.length - 1] || a !== g[g.length - 2]) {
                    g.push(a);
                }
            }   
            result=g.map(v => k[v][p() % k[v][0] + 1]).join('');
            if(checkbox.checked){
                navigator.clipboard.writeText(result).then(function() {
                    document.getElementById('resultParagraph').textContent = 'Result copied to clipboard!';
                    document.getElementById('textInput').value=''
                    document.getElementById('numberInput').value=''
                }).catch(function(err) {
                    console.error('Failed to copy Result: ', err);
                });
            }
            else
            {
                document.getElementById('resultParagraph').textContent = result;
            }
        });        
    </script>
</body>
</html>
